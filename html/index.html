<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">

		<title>Cryptobox</title>
		<link rel="stylesheet" type="text/css" href="../html/css/style.css" />
		<link rel="stylesheet" type="text/css" href="../html/extern/jquery-ui/css/<?jquery_ui_theme?>/jquery-ui-1.8.20.custom.css" />

		<script type="text/javascript" src="../html/extern/jquery/jquery-1.7.2.min.js"></script>
		<script type="text/javascript" src="../html/extern/jquery-ui/js/jquery-ui-1.8.20.custom.min.js"></script>

		<script type="text/javascript" src="../html/extern/seedrandom.js"></script>

		<script type="text/javascript" src="../html/extern/cjs/crypto/crypto-min.js"></script>
		<script type="text/javascript" src="../html/extern/cjs/blockmodes/blockmodes-min.js"></script>
		<script type="text/javascript" src="../html/extern/cjs/aes/aes-min.js"></script>
		<script type="text/javascript" src="../html/extern/cjs/hmac/hmac-min.js"></script>
		<script type="text/javascript" src="../html/extern/cjs/sha1/sha1-min.js"></script>
		<script type="text/javascript" src="../html/extern/cjs/pbkdf2/pbkdf2-min.js"></script>

		<script type="text/javascript" src="../html/js/login.js"></script>
		<script type="text/javascript" src="../html/js/view.js"></script>
		<script type="text/javascript" src="../html/js/password.js"></script>
		<script type="text/javascript" src="../html/js/crypto.js"></script>
		<script type="text/javascript" src="../html/js/lock.js"></script>
		<script type="text/javascript" src="../html/js/ui/jquery-ui.js"></script>

		<script type="text/javascript">
function lock() {
	lockTimeoutStop();

	$("#div-generate").dialog('close');
	$("#div-token").dialog('close');

	$("#div-locked").show();
	$("#div-unlocked").hide();

	$("div.generated").remove();
}

$(document).ready(function() {
	$("#div-unlocked").hide();
	$("#div-locked").show();

	$(".button").button();

	$("#button-unlock").button({ icons: { primary: "ui-icon-unlocked" } });
	$("#button-lock").button({ icons: { primary: "ui-icon-locked" } });
	$("#button-generate-show").button({ icons: { primary: "ui-icon-gear" } });

	$("#form-unlock").submit(function(event) {
		event.preventDefault();
		try {
			map = unlock($("#input-password").val());
			$("#input-password").val("");

			$("#div-login").html(map.page.login);
			$("#div-app").html(map.page.app);
			$("#div-bookmark").html(map.page.bookmark);
			$("#div-card").html(map.page.card);
			$("#div-note").html(map.page.note);

			$("#div-locked").hide();
			$("#div-unlocked").show();

			$("#div-generate").hide();
			$("#div-token").hide();

			$(".button").button();
			$(".button-token").button({ icons: { primary: "ui-icon-lightbulb" } });
			$(".button-goto").button({ icons: { primary: "ui-icon-newwin" } });
			$(".button-login").button({ icons: { primary: "ui-icon-key" } });
			$(".accordion").accordion({
				autoHeight: false,
				navigation: false,
				active: false,
				collapsible: true
			});
			$('.expand').click(function() {
				event.preventDefault();
				$(this).next().toggle();
			}).next().hide();

			lockTimeoutStart();

			$("#tabs").tabs();
		} catch(e) {
			alert("Incorrect password! " + e);
			return;
		}
	});

	$("body").mousemove(function() { lockTimeoutUpdate(); });

	$("#button-lock").click(function(event) {
		event.preventDefault();
		lock();
	});

	$("#button-generate-show").click(function(event) {
		event.preventDefault();
		$("#div-generate").dialog({
			resizable: false,
			buttons: {
				"Generate": function() {
					$("#intput-generated-password").val(generatePassword(
						$("#input-password-length").val(),
						$("#input-include-num").is(":checked"),
						$("#input-include-punc").is(":checked"),
						$("#input-include-uc").is(":checked"),
						$("#input-pronounceable").is(":checked")));
				},
				"Cancel": function() { $(this).dialog('close'); }
			}
		});
	});

	$("#input-pronounceable").click(function() {
		if ($("#input-pronounceable").is(":checked")) {
			$("#input-include-num").attr("disabled", true);
			$("#input-include-punc").attr("disabled", true);
		} else {
			$("#input-include-num").removeAttr("disabled");
			$("#input-include-punc").removeAttr("disabled");
		}
	});


	$("#input-password").focus();
});
		</script>
	</head>
	<body>
		<noscript>
			Sorry, this thing heavily depends on JavaScript.
		</noscript>

		<div id="div-locked">
			<form id="form-unlock">
				<h1>Enter password to unlock</h1>
				<p><input id="input-password" type="password" /></p>
				<p><button type="submit" id="button-unlock">Unlock</button></p>
			</form>
		</div>

		<div id="div-unlocked">
			<div id="div-header">
				<button id="button-generate-show">Generate password</button>
				<button id="button-lock">Lock</button>
			</div>

			<div id="tabs">
				<ul>
					<li><a href="#div-login">Logins</a></li>
					<li><a href="#div-app">Apps</a></li>
					<li><a href="#div-bookmark">Bookmarks</a></li>
					<li><a href="#div-card">Cards</a></li>
					<li><a href="#div-note">Notes</a></li>
					<li><a href="#div-help">Help</a></li>
				</ul>

				<div id="div-login"></div>
				<div id="div-app"></div>
				<div id="div-bookmark"></div>
				<div id="div-card"></div>
				<div id="div-note"></div>
				<div id="div-help">
					<h2>Help</h2>
					<p>There will be user documentation... Someday...</p>

					<h2>Bookmarklet</h2>

					<h3><a id="bookmarkletForm" href="javascript:javascript:(function(){_my_script=document.createElement('SCRIPT');_my_script.type='text/javascript';_my_script.src='<?path_bookmarklets?>form.js';document.getElementsByTagName('head')[0].appendChild(_my_script);})();">Parse form</a></h3>
					<p>Use this bookmarklet to obtain form data from the new sites.</p>
				</div>
			</div>

			<div id="div-generate" title="Generate password">
				<form>
					<input type="text" id="input-password-length" value="16" size="4" />Length<br />
					<input type="checkbox" id="input-include-num" checked />Include numbers<br />
					<input type="checkbox" id="input-include-punc" checked />Include punctuation<br />
					<input type="checkbox" id="input-include-uc" checked />Include upper case<br />
					<input type="checkbox" id="input-pronounceable" />Make pronounceable<br />
					<p>Generated password:</p>
					<p><input type="text" id="intput-generated-password" size="30" /></p>
				</form>
			</div>

			<div id="div-token" title="Enter token">
				<input type="text" id="input-json" size="32" />
			</div>

			<div id="div-copyright" class="ui-widget"><p>&copy; <a href="mailto:s@fomichev.me">Stanislav Fomichev</a> 2012</p></div>
		</div>
	</body>
</html>
